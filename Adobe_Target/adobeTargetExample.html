<html>
<head>
    <title>Demandbase Adobe Target Integration Example</title>

    <!-- Asynchronous Method - Define callback function
         Note: this must be defined before the IP API call  -->
    <script type="text/javascript">
        function set_mbox_variables(data) {
            /**
                This function is called when Demandbase returns data.
                Iteratively add each Demandbase Company Profile to
                the visitor's Adobe Target Profile
            **/
            if(!data) return;
            try {
                var profileAttrStr = "", delim = ',', builder;
                for (var key in data) {
                    if (data.hasOwnProperty(key)) {
                        var attr = 'profile.' + key + '=' + data[key] + delim;
                        profileAttrStr += attr;
                    }
                }
                profileAttrStr = profileAttrStr.split(delim);
                builder = mboxFactoryDefault.getUrlBuilder();
                builder.addParameters(profileAttrStr)
            } catch (e) {}
        }
    </script>

    <!-- Asynchronous Method - Call IP API,
         This triggers callback function when data is returned -->
    <script type="text/javascript" src="http://api.demandbase.com/api/v2/ip.json?key=YOUR_KEY_HERE&callback=set_mbox_variables"></script>
</head>
<body>
    <!-- mbox.js include must come after the Demandbase API and callback function to ensure they fire before the mbox is created -->
    <script type="text/javascript" src="Your/Mbox/Path/mbox.js"></script>
    <p>Demandbase / Adobe Target Integration Example</p>
    <p>See also <a href="https://github.com/demandbaselabs/demandbaselabs/blob/master/Adobe_Target/" target="_blank">Adobe Target Connector</a></p>
    <hr />
</body>
</html>