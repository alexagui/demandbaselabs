<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
	<head>
		<title>Demandbase IP Widget Tester</title>
		<!-- jQuery includes -->
        <link type="text/css" href="css/ui-lightness/jquery-ui-1.8.21.custom.css" rel="stylesheet" />
        <script type="text/javascript" src="scripts/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="scripts/jquery-ui-1.8.21.custom.min.js"></script>

        <!-- IP Widget Includes -->
        <link href="css/ipWidget.css" type="text/css" rel="stylesheet"/>
        <script type="text/javascript" src="scripts/ipWidget_beta.js"></script>
        
        <!--Including Demandbase Compant Autocomplete Widget For convenience (not used here) -->
        <script src="http://api.demandbase.com/autocomplete/widget.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" href="http://autocomplete.demandbase.com/autocomplete/stylesheet.v2.css" />

        <!-- add Demandbase Client script -->
        <script type="text/javascript" src="https://dkj2m377b0yzw.cloudfront.net/clients/javascript/demandbase-1.0.0-min.js"></script>
        
        <!-- Instantiate Client + call the Demandbase IP Address API -->
        <script type="text/javascript">
            jQuery(document).ready(function() {
            	var db_client = new DemandbaseClient("YOUR_KEY_HERE");
            	overrideIP = jQuery("#overrideIpAddress").val() || '';
            	//if(db_client) {
            		//calling the IP address API, defining inline callback and calling IP Widget Callback
	            	db_client.ip(overrideIP, function(company) {
              			if (company && company.company_name) {
	               			//This runs when the visitor's company is identified

                            //calling this function instantiates the IP Widget
	               			DemandbaseLabs.IPWidget.demandbase_parse(company);   //callback function defined in ipWidget.js
	               			
                            //Note: callback function can be passed as second parameter instead of defining an inline function for callback 
	               			
	               			// ADD YOUR CUSTOMIZATION CODE HERE
	               			companyName = company.company_name || company.registry_company_name || '[not detected]';
	               			jQuery("#testP").html("Test page for the Demandbase IP Widget <br/> Detected Company: " + companyName);
              			} else if (company) {
                            //This runs when the visitor is classified (eg only audience and registry info are available)
                            companyName = company.registry_company_name || '[not detected]';
                            jQuery("#testP").html("Test page for the Demandbase IP Widget <br/> Detected Company: " + companyName);
                        }
	            	});
            	//}
            });
        </script>
	</head>
	<body>
		<h3 id="testP">
			Test page for the Demandbase IP Widget <br/>
			Detected Company: [company_name]
		</h3>
		<h4>See the <a href="Readme.txt">Readme File</a>  for info on how to get setup.</h4>

		<p id="sampleForm">
			<h2>Sample Form</h2>
			<h4>Note: This is not connected to the IP Widget in this example</h4>
			Email: <input type="text" id="emails"/> <br/>
			Company: <input type="text" id="company"/>
		</p>
		<!--Call Autocomplete, attach input fields, pass key and callback-->
        <script type="text/javascript">
            Demandbase.CompanyAutocomplete.widget({
                company: "company",  // attach autocomplete to input field with id = company
                email: "email",             // attach autocomplete to input field with id = email
                key: "YOUR_KEY_HERE",     //  add your Demandbase Forms key here
                label: "{marketing_alias} ({city}, {country}) - {industry}",
                callback: DemandbaseLabs.IPWidget.demandbase_override   // the callback to call.
            });
        </script>


	</body>
</html>
